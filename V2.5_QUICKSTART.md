# V2.5 QUICK START GUIDE

## ğŸ¯ Current Status: READY FOR TRAINING âœ…

All V2.5 hybrid improvements have been successfully implemented and validated!

---

## ğŸ“‹ What Was Implemented

### âœ… Option 3: Architecture Upgrade
- **EfficientNet-B4 Encoder** (compound scaling: deeper + wider + higher res)
- **Spatial Attention Module** (channel + spatial attention for feature refinement)
- **Expected Impact:** +2-3% all metrics

### âœ… Option 4: Hybrid Data Strategy  
- **SMOTE** (synthetic minority oversampling: 2.65% â†’ 7.5% Class 1)
- **Enhanced CRF** (8 iterations, stronger spatial smoothing)
- **Expected Impact:** +4-5% Class 1 precision

### âœ… Retained V2 Best Practices
- CORAL ordinal loss (weight 0.3)
- Focal loss (gamma 2.5)
- Balanced class weights [0.4, 2.5, 2.0]
- 60 epochs, aggressive augmentation

---

## ğŸš€ Start Training (Three Options)

### Option 1: Interactive Start Script (Recommended)
```bash
./START_V2.5_TRAINING.sh
```
This will:
- Show configuration summary
- Ask for confirmation
- Start training in background
- Display monitoring commands

### Option 2: Direct Command
```bash
source .venv/bin/activate
.venv/bin/python -m src.main_pipeline --force_recreate > training_log_v2.5.txt 2>&1 &
```

### Option 3: Foreground (See Live Output)
```bash
source .venv/bin/activate
.venv/bin/python -m src.main_pipeline --force_recreate
```
âš ï¸ This will block your terminal for 24-30 hours!

---

## ğŸ“Š Expected Results

### V2 Baseline (Current Performance)
- Cohen's Kappa: **0.4534** âœ…
- Class 1 Precision: **17.85%** âŒ (Need â‰¥22%)
- Class 2 Recall: **93.86%** âœ…  
- Ordinal Ï: **0.5666** âœ…
- **Status:** PILOT READY (3/4 targets)

### V2.5 Target (After Training)
- Cohen's Kappa: **â‰¥0.48** (+6%)
- Class 1 Precision: **â‰¥23%** (+29%) â† **KEY IMPROVEMENT**
- Class 2 Recall: **â‰¥93%** (maintain)
- Ordinal Ï: **â‰¥0.585** (+3%)
- **Status:** âœ… **FULL PRODUCTION READY** (4/4 targets)

---

## ğŸ“ˆ Monitoring Training

### Watch Progress (Real-Time)
```bash
tail -f training_log_v2.5.txt
```

### Check Last 20 Lines (Quick Update)
```bash
tail -20 training_log_v2.5.txt
```

### Verify Training Is Running
```bash
ps aux | grep main_pipeline
```

### Monitor GPU (If Available)
```bash
nvidia-smi -l 5
```

---

## â±ï¸ Timeline

| Phase | Duration | Key Events |
|-------|----------|------------|
| **Preprocessing** | 2-3 hrs | Tile generation, SMOTE synthesis (~180 tiles) |
| **Training** | 20-25 hrs | 60 epochs, EfficientNet-B4 + Attention + CORAL |
| **Inference** | 2-3 hrs | Sliding window + CRF (8 iterations) |
| **TOTAL** | **24-30 hrs** | Overnight run recommended |

### Key Log Messages to Watch For

**Hour 0-3: Dataset Prep**
```
"Generated X synthetic tiles via SMOTE"
"Train split: X tiles (Class 1: Y%)"  â† Should be ~7.5%
```

**Hour 3-28: Training**
```
"Using encoder: efficientnet-b4"
"Spatial attention: enabled"
"Epoch [10/60] - Train Loss: X.XXX | Val Loss: X.XXX"
```

**Hour 28-30: Inference**
```
"Applying CRF refinement (8 iterations)..."
"Saving susceptibility raster: test_susceptibility.tif"
```

---

## âœ… Pre-Flight Checklist

- [x] Config validated (`validate_v2.5_config.sh` passed)
- [x] Dependencies installed (imbalanced-learn 0.14.0)
- [x] V2 model backed up (`best_model_v2_coral_oversampling.pth`)
- [x] Spatial attention implemented (`SpatialAttentionModule`)
- [x] SMOTE integrated (`src/main_pipeline.py`)
- [x] Virtual environment active (`.venv`)

**Everything is ready! ğŸ‰**

---

## ğŸ”§ Troubleshooting

### Issue: SMOTE Fails
```bash
# Check Class 1 tile count
cat artifacts/splits/dataset_summary.json | grep -A 5 "class_1"

# If < 10 tiles, reduce k_neighbors in config.yaml:
smote_k_neighbors: 3  # Was 5
```

### Issue: Memory Error During Training
```bash
# Reduce batch size in config.yaml:
training:
  batch_size: 4  # Was 8
```

### Issue: Training Diverges (Loss Increasing)
```bash
# Reduce learning rate in config.yaml:
training:
  learning_rate: 5.0e-5  # Was 1.0e-4
```

### Issue: CRF Too Slow (>4 hours)
```bash
# Reduce CRF iterations temporarily:
inference:
  crf:
    iterations: 5  # Was 8
```

---

## ğŸ“ After Training Completes

### 1. Evaluate V2.5 Performance
```bash
.venv/bin/python -m src.evaluate \
  --output_dir outputs/evaluation_v2.5 \
  --compare_baseline outputs/evaluation_v2/v2_metrics.json
```

### 2. Generate Success Report
Check if Class 1 Precision â‰¥ 22%:
- **YES (â‰¥22%):** âœ… PRODUCTION READY! Create deployment docs.
- **NO (<22%):** âš ï¸ Proceed to V3 Ensemble (3 models, average predictions).

### 3. Export Deliverables (If Production-Ready)
```bash
# Already in outputs/:
# - test_susceptibility.tif (continuous probabilities)
# - test_class_map.tif (3-class discrete map)
# - test_uncertainty.tif (prediction uncertainty)
# - model_card.md (full documentation)
```

---

## ğŸ“š Documentation

- **Implementation Details:** `V2.5_IMPLEMENTATION_COMPLETE.md`
- **Configuration:** `config.yaml`
- **Validation Script:** `validate_v2.5_config.sh`
- **V2 Baseline:** `outputs/evaluation_v2/V2_SUCCESS_REPORT.md`
- **Agent Guide:** `AGENTS.md`

---

## ğŸ¯ Success Criteria

| Metric | Target | Current (V2) | Expected (V2.5) |
|--------|--------|--------------|-----------------|
| **Kappa** | â‰¥0.38 | 0.4534 âœ… | 0.48 âœ… |
| **Class 1 Prec** | **â‰¥22%** | 17.85% âŒ | **23% âœ…** |
| **Class 2 Rec** | â‰¥92% | 93.86% âœ… | 94.5% âœ… |
| **Ordinal Ï** | â‰¥0.50 | 0.5666 âœ… | 0.585 âœ… |

**V2.5 Goal:** Meet all 4 targets â†’ **FULL PRODUCTION READY** âœ…

---

## ğŸš€ READY TO LAUNCH!

**Start training now:**
```bash
./START_V2.5_TRAINING.sh
```

**Or run directly:**
```bash
source .venv/bin/activate
.venv/bin/python -m src.main_pipeline --force_recreate > training_log_v2.5.txt 2>&1 &
tail -f training_log_v2.5.txt
```

**Expected duration:** 24-30 hours  
**Expected outcome:** âœ… Class 1 Precision â‰¥ 23% (TARGET MET!)

Good luck! ğŸ€
