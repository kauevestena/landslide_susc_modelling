# Configuration for the Landslide Vulnerability Pipeline

project_structure:
  raw_data_dir: artifacts/raw
  derived_data_dir: artifacts/derived
  tiles_dir: artifacts/tiles
  labels_dir: artifacts/labels
  splits_dir: artifacts/splits
  experiments_dir: artifacts/experiments
  outputs_dir: outputs
  metadata_dir: artifacts/metadata

inputs:
  module: inputs
  train:
    dtm_attr: DTM_train
    ortho_attr: ortophoto_train
    ground_truth_attr: ground_truth_train
  test:
    dtm_attr: DTM_test
    ortho_attr: ortophoto_test
    ground_truth_attr: null

preprocessing:
  resampling:
    ortho: bilinear
    ground_truth: nearest
  dtm_hygiene:
    sink_fill_kernel: 5
    gaussian_sigma: 1.0
  hydrology:
    drainage_threshold: 5000.0
  derived_channels:
    include_dtm: true
    include_slope: true
    include_aspect_sin_cos: true
    include_curvatures: true
    include_tpi: true
    include_tri: true
    include_flow_accumulation: true
    include_twi: true
    include_spi: true
    include_sti: true
    include_distance_to_drainage: true
  orthophoto_channels:
    radiometric_normalization: zscore
    land_cover_clusters: 6
  normalization:
    strategy: zscore
    epsilon: 1.0e-6
  boundary_ignore_pixels: 2
  min_valid_fraction: 0.55

dataset:
  tile_size: 512
  tile_overlap: 64
  block_grid: [1, 1]
  positive_class: 2
  positive_min_fraction: 0.01
  positive_fraction: 0.5
  negative_slope_threshold_deg: 30.0
  min_valid_fraction: 0.5
  val_size: 0.15
  test_size: 0.2
  max_tiles_per_split: null
  random_state: 42

model:
  encoder: resnet34
  encoder_weights: imagenet
  out_classes: 3
  dropout_prob: 0.2

training:
  use_cuda: false  # Set to true only if GPU is compatible (requires CUDA compute capability >= 7.0)
  batch_size: 4
  learning_rate: 0.0003
  weight_decay: 1.0e-4
  epochs: 20
  lr_scheduler: cosine
  early_stopping_patience: 5
  mixed_precision: true
  gradient_clip_norm: 1.0
  augmentations:
    brightness: 0.2
    contrast: 0.2
    saturation: 0.2
    hue: 0.02
    blur_prob: 0.1
    noise_std: 0.01
    flip_prob: 0.5

metrics:
  calibration_bins: 15

inference:
  use_cuda: false  # Set to true only if GPU is compatible (requires CUDA compute capability >= 7.0)
  window_size: 512
  overlap: 256
  tta: true
  tta_augmentations: 8  # Number of TTA augmentations (0=disabled, 4=basic, 8=full)
  mc_dropout_iterations: 5
  batch_size: 2
  blending:
    method: gaussian  # Options: gaussian, linear, none
    sigma_factor: 0.3  # For gaussian: sigma = overlap * sigma_factor
  crf:
    enabled: true
    iterations: 5  # Number of CRF inference iterations
    spatial_weight: 3.0  # Bilateral spatial standard deviation
    color_weight: 3.0  # Bilateral color/feature standard deviation
    compat_spatial: 3.0  # Spatial compatibility weight
    compat_bilateral: 10.0  # Bilateral compatibility weight

reproducibility:
  seed: 42

