# Configuration for the Landslide Vulnerability Pipeline

project_structure:
  raw_data_dir: artifacts/raw
  derived_data_dir: artifacts/derived
  tiles_dir: artifacts/tiles
  labels_dir: artifacts/labels
  splits_dir: artifacts/splits
  experiments_dir: artifacts/experiments
  outputs_dir: outputs
  metadata_dir: artifacts/metadata

inputs:
  module: inputs
  train:
    dtm_attr: DTM_train
    ortho_attr: ortophoto_train
    ground_truth_attr: ground_truth_train
  test:
    dtm_attr: DTM_test
    ortho_attr: ortophoto_test
    ground_truth_attr: ground_truth_test

preprocessing:
  resampling:
    ortho: bilinear
    ground_truth: nearest
  dtm_hygiene:
    sink_fill_kernel: 5
    gaussian_sigma: 1.0
  hydrology:
    drainage_threshold: 5000.0
  derived_channels:
    include_dtm: true
    include_slope: true
    include_aspect_sin_cos: true
    include_curvatures: true
    include_tpi: true
    include_tri: true
    include_flow_accumulation: true
    include_twi: true
    include_spi: true
    include_sti: true
    include_distance_to_drainage: true
  orthophoto_channels:
    radiometric_normalization: zscore
  external_lulc:
    enabled: true
    source: worldcover  # Options: worldcover, dynamic_world, none
    worldcover:
      year: 2021  # 2020 or 2021
    dynamic_world:
      start_date: null  # YYYY-MM-DD format, null for auto (last 6 months)
      end_date: null
      use_probabilities: false  # Use probability bands instead of hard classification
      ee_project: null  # Google Cloud project ID for Earth Engine
    force_download: false  # Force re-download even if cached files exist
  normalization:
    strategy: zscore
    epsilon: 1.0e-6
  boundary_ignore_pixels: 2
  min_valid_fraction: 0.4  # RELAXED from 0.55 to match dataset min_valid_fraction

dataset:
  tile_size: 256  # REDUCED from 512 to create ~4x more tiles
  tile_overlap: 32  # REDUCED proportionally (was 64)
  block_grid: [1, 1]
  positive_class: 2
  positive_min_fraction: 0.005  # RELAXED from 0.01 (0.5% instead of 1%)
  positive_fraction: 0.3  # REDUCED from 0.5 to allow more negative tiles
  negative_slope_threshold_deg: 30.0
  min_valid_fraction: 0.4  # RELAXED from 0.5 (40% instead of 50%)
  val_size: 0.15
  test_size: 0.2
  max_tiles_per_split: null
  random_state: 42

model:
  encoder: resnet34
  encoder_weights: imagenet
  out_classes: 3
  dropout_prob: 0.2

training:
  use_cuda: false  # Set to true only if GPU is compatible (requires CUDA compute capability >= 7.0)
  batch_size: 4
  learning_rate: 0.0003
  weight_decay: 1.0e-4
  epochs: 30  # INCREASED from 20 since we now have proper validation for early stopping
  lr_scheduler: cosine
  early_stopping_patience: 7  # INCREASED from 5 to allow more recovery time
  mixed_precision: true
  gradient_clip_norm: 1.0
  augmentations:
    brightness: 0.2
    contrast: 0.2
    saturation: 0.2
    hue: 0.02
    blur_prob: 0.1
    noise_std: 0.01
    flip_prob: 0.5

metrics:
  calibration_bins: 15

inference:
  use_cuda: false  # Set to true only if GPU is compatible (requires CUDA compute capability >= 7.0)
  window_size: 1024
  overlap: 256
  tta: false
  tta_augmentations: 0  # Number of TTA augmentations (0=disabled, 4=basic, 8=full)
  mc_dropout_iterations: 0
  batch_size: 2
  smoothing_alpha: 0.5
  class_breaks: [0.5, 0.7]
  temperature_override: 2.5
  blending:
    method: gaussian  # Options: gaussian, linear, none
    sigma_factor: 0.3  # For gaussian: sigma = overlap * sigma_factor
  crf:
    enabled: false
    iterations: 5  # Number of CRF inference iterations
    spatial_weight: 3.0  # Bilateral spatial standard deviation
    color_weight: 3.0  # Bilateral color/feature standard deviation
    compat_spatial: 3.0  # Spatial compatibility weight
    compat_bilateral: 10.0  # Bilateral compatibility weight
    tile_size: 4096  # Tile size for memory-efficient CRF processing
    overlap: 2048  # Overlap between CRF tiles for smooth blending

reproducibility:
  seed: 42
